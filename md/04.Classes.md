
## Classes
### Building Musical Tools

---H

## Functions and Oscillators
- Functions group code together
- Example:
  - function that creates an oscillator and gain node
  - Connects them to the global AudioContext
  - Runs an ADSR envelope

---H

### Example Function
```js
//scroll to see the complete code....
function playNote(someContext, frequency, duration) {
    const osc = new OscillatorNode(someContext);
    const gain = new GainNode(someContext);
    osc.frequency.value = frequency;
    osc.type = "triangle"
    gain.gain.value = 0;

    osc.connect(gain).connect(someContext.destination);

    let now = someContext.currentTime;
    gain.gain.linearRampToValueAtTime(0.25, now + 0.25);  // attack
    gain.gain.linearRampToValueAtTime(0, now + duration); // release

    osc.start();
    osc.stop(now + duration);
}

const myCtx = new AudioContext();
document.querySelector("button").onclick = ()=> playNote(myCtx, 220, 2); // must decide duration in advance
```

<iframe
data-src="../embedded-examples/Week2/w4.1.html"
width="75%" height="50" style="border: 2px solid black; border-radius: 6px;">
</iframe>


---H

## Key Limitation of Functions

<ul>
  <li class="fragment fade-in">You must know the note length <em>ahead of time</em></li>
  <li class="fragment fade-in">Once the function starts, the envelope and stop time are fixed</li>
  <li class="fragment fade-in">No way to decide "in the moment" when the note should end</li>
  <li class="fragment fade-in">Not flexible for real-time performance</li>
</ul>

---H

## Classes
<ul>
  <li class="fragment fade-in">A <span style="color: red"><b>class</b></span> is a blueprint for creating objects with shared structure and behavior</li>
  <li class="fragment fade-in">Classes package <strong><span style="color: blue">data</span></strong> (properties) and <strong><span style="color: purple">functionality</span></strong> (methods) together</li>
</ul>


---H

## Musical Note Class

<ul>
  <li class="fragment fade-in">Each instance needs:
    <ul>
      <li class="fragment fade-in">to create its own
        <ul>
          <li class="fragment fade-in">oscillator</li>
          <li class="fragment fade-in">gain (envelope)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li class="fragment fade-in">the ability to store <strong><span style="color: blue">parameters</span></strong> (properties)
    <ul>
      <li class="fragment fade-in">frequency</li>
      <li class="fragment fade-in">the 'parent' audio context</li>
      <li class="fragment fade-in">anything else we want</li>
    </ul>
  </li>
  <li class="fragment fade-in">the ability to execute <strong><span style="color: purple">methods</span></strong> (functionality)
    <ul>
      <li class="fragment fade-in">start a note now</li>
      <li class="fragment fade-in">stop a note</li>
    </ul>
  </li>
</ul>


---H

## Anatomy of a Class
### Making a new object template

<ol>
  <li class="fragment fade-in"><strong>class Keyword</strong>: starts the definition</li>
  <li class="fragment fade-in"><strong>Constructor</strong>: runs when you make a new instance</li>
  <li class="fragment fade-in"><strong>Properties</strong>: values stored in the object (<code>this.width</code>, <code>this.height</code>)</li>
  <li class="fragment fade-in"><strong>Methods</strong>: actions the object can perform (<code>area()</code>)</li>
</ol>


---H

## Generic Example

```js
// Define a class (a blueprint for creating rectangle objects)
class Rectangle {
    // The "constructor" is a special function name.
    // It is automatically called when you use the "new" keyword.
    // The constructor runs when you call "new Rectangle(...)"
    // It sets up the initial properties of the object
    constructor(w, h) { // The parameters (w, h) are temporary variables
        this.width = w;     // property: stores the width of this rectangle
        this.height = h;   // property: stores the height of this rectangle
    }
    // A method: functions that belong to the class
    // Methods can use "this" to access the object's properties
    area() {
        return this.width * this.height; // calculate area from width * height
    }
}

```

---H

## The `this` Keyword

<ul>
  <li class="fragment fade-in">Refers to the current <em>instance</em> of the class</li>
  <li class="fragment fade-in">Inside constructor: <code>this.width</code>, <code>this.height</code></li>
  <li class="fragment fade-in">Each instance has its own properties via <code>this</code></li>
  <li class="fragment fade-in">This allows each <em>instance</em> or copy of the class to maintain its own data</li>
</ul>


---H

## Creating Instances of a Class
#### Making a new objects based off of a template

<ul>
  <li class="fragment fade-in">A <strong><span style="color: red">class</span></strong> is just the template
    <ul>
      <li class="fragment fade-in">like a mold or a recipe</li>
    </ul>
  </li>
  <li class="fragment fade-in">An <strong><span style="color: blue">instance</span></strong> is a concrete object created from that template
    <ul>
      <li class="fragment fade-in">Use the <code>new</code> keyword to create an instance</li>
    </ul>
  </li>
  <li class="fragment fade-in">Each instance has its own copy of the properties</li>
  <li class="fragment fade-in">Methods belong to the class but are used through the instance</li>
</ul>


---H

## Class Example

```js

let rect1 = new Rectangle(5, 10);
let rect2 = new Rectangle(4, 3);
console.log(rect1.area()); // 50
console.log(rect2.area()); // 12

rect1.width = 8;
console.log(rect1.area()); // 80
```
<iframe
data-src="../embedded-examples/Week2/w4.2.html"
width="75%" height="50" style="border: 2px solid black; border-radius: 6px;">
</iframe>
---H



## SynthNote Class

```js
class SynthNote {
  constructor(someAudCtx, frequency) {
    this.ctx = someAudCtx; // store context in the instance
    this.osc = new OscillatorNode(this.ctx);
    this.adsr = new GainNode(this.ctx);
    this.osc.frequency.value = frequency;
    this.adsr.gain.value = 0;

    this.osc.connect(this.adsr).connect(ctx.destination);
  }

  start() {
    let now = this.ctx.currentTime;
    this.adsr.gain.linearRampToValueAtTime(0.25, now + 0.25); // attack
    this.osc.start();
  }

  stop() {
    let now = this.ctx.currentTime;
      this.adsr.gain.setValueAtTime(this.adsr.gain.value, now)
    this.adsr.gain.linearRampToValueAtTime(0, now + 2); // release
    this.osc.stop(now + 1);
  }
}
```

---H

## Using the Class

```js
const ctx = new AudioContext();
let note;
document.querySelector("#startButton").onclick = ()=> {
    note = new SynthNote(ctx, 440);
    note.start();
}
document.querySelector("#stopButton").onclick = ()=> note.stop();
```
<iframe
data-src="../embedded-examples/Week2/w4.3.html"
width="75%" height="50" style="border: 2px solid black; border-radius: 6px;">
</iframe>
---H
## Synth Class
* Start a note and let it ring
* Stop it whenever you decide
* Much closer to how instruments work

---H


## More Control, More Problems
### _What issues does this raise?_
<ul>
  <li class="fragment fade-in">What happens when you play multiple notes?</li>
  <li class="fragment fade-in">How do you keep track of them?</li>
  <li class="fragment fade-in">Can each note have its own properties like pitch and volume?</li>
<li class="fragment fade-in">Can all notes share properties like delay time?</li>
</ul>
---H

## Comparing Approaches

* **Function**: quick, but locked to fixed duration
* **Class**: reusable, flexible, and real-time controllable
* **`this`** makes instance-specific control possible

---H

## Wrap Up

<ul>
  <li class="fragment fade-in">A <strong>class</strong> is a blueprint for creating objects with shared structure and behavior</li>
  <li class="fragment fade-in">Functions are good for simple, fixed behaviors</li>
  <li class="fragment fade-in">Classes allow interactive, performance-like control</li>
  <li class="fragment fade-in">Anatomy:
    <ul>
      <li class="fragment fade-in">class &rarr; constructor &rarr; properties &rarr; methods &rarr; instances</li>
    </ul>
  </li>
  <li class="fragment fade-in">Next:
    <ul>
      <li class="fragment fade-in">voice management</li>
      <li class="fragment fade-in">expand class to include filters, effects, and more synthesis features</li>
    </ul>
  </li>
</ul>

